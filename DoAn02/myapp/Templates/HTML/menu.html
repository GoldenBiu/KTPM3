{% load static %}
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="{% static 'CSS/menu.css' %}">

        <!--css-->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <link href="{% static 'app/css/style.css' %}" rel="stylesheet" />
        <link href="{% static 'app/css/owl.caroysel.min.css' %}" rel="stylesheet" />
        <link href="{% static 'app/css/all.min.css' %}" rel="stylesheet" />
        <!-- js -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
      
        <script src="{% static 'app/js/s3.js' %}"> </script>
        <script src="{% static 'app/js/all.min.js' %}"> </script>
        <script src="{% static 'app/js/m√Ωcript.js' %}"> </script>

        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    </head>
    
    <body>
        <header class="header">
            <div class="menu-toggle">‚ò∞</div>
            <div class="header-title">Nh√† tr·ªç C·∫ßn Th∆°</div>

            <div class="search-bar">
              <form method="GET" action="{% url 'menu' %}" style="display: flex; align-items: center;">
                <input type="text" name="search" placeholder="T√¨m theo: S·ªë ph√≤ng, D√£y, T√™n kh√°ch h√†ng, S·ªë ƒëi·ªán tho·∫°i, Ti·ªán √≠ch, Di·ªán t√≠ch..." value="{{ search_query }}" title="T√¨m ki·∫øm theo: S·ªë ph√≤ng, D√£y, T√™n kh√°ch h√†ng, S·ªë ƒëi·ªán tho·∫°i, Ti·ªán √≠ch, Di·ªán t√≠ch" />
                <button class="timkiem" type="submit">üîç</button>
                
                <div class="button-group">
                  <button class="btn dathue" type="submit" name="trang_thai" value="DaThue">Ph√≤ng ƒë√£ thu√™</button>
                  <button class="btn phongtrong" type="submit" name="trang_thai" value="ConTrong">Ph√≤ng c√≤n tr·ªëng</button>
                  <button class="btn hientatca" type="submit" name="trang_thai" value="">Hi·ªán t·∫•t c·∫£ ph√≤ng</button>
                </div>
              </form>
            </div>
          </header> 
          
          {% if messages %}
          <div class="messages">
              {% for message in messages %}
              <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
              {% endfor %}
          </div>
          {% endif %}
        
          <div class="sidebar">
            <div class="logo_content">
                
                <div class="logo">
                  <div class="icon">
                    <img src="{% static '/imag/moi.jpg' %}" alt="Logo">
                  </div>
                  <div class="logo_name">Xin ch√†o, {{ ho_ten_quan_li }}</div>
                </div>
                
            </div>

            <ul class="nav_list">
              <li>
                <a href="{% url 'menu' %}">
                  <span class="icon">üè†</span>
                  <span class="link_name">Trang ch·ªß</span>
                </a>
              </li>
              <li>
                <a href="{% url 'quan_ly_khach_hang' %}">
                  <span class="icon">üßë‚Äçüíº</span>
                  <span class="link_name">Qu·∫£n l√Ω kh√°ch h√†ng</span>
                </a>
              </li>
              <li>
                <a href="{% url 'doanh_thu' %}">
                  <span class="icon">üí∞</span>
                  <span class="link_name">Doanh thu</span>
                </a>
              </li>
              <li>
                <a href="{% url 'dich_vu' %}">
                  <span class="icon">üí°</span>
                  <span class="link_name">D·ªãch v·ª•</span>
                </a>
              </li>
              <li>
                <a href="{% url 'hoa_don' %}">
                  <span class="icon">üßæ</span>
                  <span class="link_name">H√≥a ƒë∆°n</span>
                </a>
              </li>
              <li>
                <a href="{% url 'quan_li_hop_dong' %}">
                  <span class="icon">üìÇ</span>
                  <span class="link_name">Qu·∫£n l√Ω h·ª£p ƒë·ªìng</span>
                </a>
              </li>
              <li>
                <a href="{% url 'dang_xuat' %}" class="logout-link">
                  <span class="icon"><i class="fas fa-sign-out-alt"></i></span>
                  <span class="link_name">ƒêƒÉng Xu·∫•t</span>
                </a>
              </li>
            </ul>

          </div>
        
          <div class="content container">
            <div class="mt-4">
              <div class="rong">   
                <h6>Danh s√°ch ph√≤ng</h6>
                <div class="room-list-header">                  
                <nav class="doi">
                  <form method="GET" action="{% url 'menu' %}" style="display: flex; align-items: center;">
                    <div class="select-container">
                      <i class="bi bi-house-door icon"></i>
                      <select name="day">
                          <option value="" disabled selected hidden>D√£y</option>
                          <option value="T·∫•t c·∫£" {% if day == 'T·∫•t c·∫£' %}selected{% endif %}>T·∫•t c·∫£</option>
                          {% for day_value in unique_days %}
                          <option value="{{ day_value }}" {% if day == day_value %}selected{% endif %}>D√£y {{ day_value }}</option>
                          {% endfor %}
                      </select>
                    </div><br>

                    <div class="select-container">
                      <i class="fa-solid fa-list-ol ico"></i> 
                      <select name="so_phong">
                          <option value="" disabled selected hidden>S·ªë ph√≤ng</option>
                          <option value="T·∫•t c·∫£" {% if so_phong == 'T·∫•t c·∫£' %}selected{% endif %}>T·∫•t c·∫£</option>
                          {% for room in unique_rooms %}
                          <option value="{{ room }}" {% if so_phong == room %}selected{% endif %}>{{ room }}</option>
                          {% endfor %}
                      </select>
                    </div><br>

                    <div class="select-container">
                      <i class="bi bi-cash-stack icon"></i>
                      <select name="gia">
                          <option value="" disabled selected hidden>Gi√°</option>
                          <option value="T·∫•t c·∫£" {% if gia == 'T·∫•t c·∫£' %}selected{% endif %}>T·∫•t c·∫£</option>
                          {% for price in unique_prices %}
                          <option value="{{ price }}" {% if gia == price %}selected{% endif %}>{{ price|floatformat:0 }}ƒë</option>
                          {% endfor %}
                      </select>
                    </div><br>

                    <div class="search-container">
                      <button class="search-btn" type="submit">
                          <i style="font-weight: bold;">Go</i>
                      </button>
                      <button class="themphong" type="button" onclick="document.location='{% url 'them_phong' %}'">+ Th√™m ph√≤ng</button>    
                    </div>
                  </form>
                </nav>
              </div>
              </nav>
            </div>

            <div class="room-list-container">
              <!-- M·ª•c 1 -->
              {% for room in rooms %}
              <div class="room-item">
                  <div class="status-header">
                      <h3>STT: {{ room.stt }}</h3>
                      {% if room.trang_thai == 'ƒêang Ho·∫°t ƒê·ªông' %}
                          <span class="status-indicator active">{{ room.trang_thai }}</span>
                      {% elif room.trang_thai == 'S·∫Øp H·∫øt H·∫°n' %}
                          <span class="status-indicator ac">{{ room.trang_thai }}</span>
                      {% elif room.trang_thai == 'H·∫øt H·∫°n' %}
                          <span class="status-indicator acoo">{{ room.trang_thai }}</span>
                      {% endif %}
                  </div>
                  <div class="info-row">
                      <p><strong>D√£y:</strong> {{ room.day_phong }}</p>
                      <p><strong>Ph√≤ng:</strong> {{ room.so_phong }}</p>
                      <p><strong>Gi√°:</strong> {{ room.gia_phong }}</p>
                      <p><strong>T√™n:</strong> {{ room.ten_khach_hang }}</p>
                      <p><strong>S·ªë ƒêi·ªán Tho·∫°i:</strong> {{ room.so_dien_thoai }}</p>
                  </div>
                  <div class="action-buttons">
                      {% if room.trang_thai == "Ch∆∞a thu√™" %}
                          <button class="btn btn-create" onclick="document.location='/themhopdong/{{ room.phong_id }}/'">Th√™m h·ª£p ƒë·ªìng</button>
                      {% else %}
                          <button class="btn btn-detail" onclick="window.location.href='/xemchitiethopdong/{{ room.hop_dong_id }}/'">Xem Chi Ti·∫øt</button>
                      {% endif %}
                      
                      {% if room.trang_thai == "Ch∆∞a thu√™" %}
                          <button class="btn btn-edit" onclick="document.location='/chinhsua/{{ room.phong_id }}/'">Ch·ªânh s·ª≠a</button>
                      {% endif %}
                      
                      {% if room.trang_thai == "Ch∆∞a thu√™" %}
                          <button class="btn btn-delete" onclick="if(confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a ph√≤ng n√†y ho√†n to√†n kh·ªèi h·ªá th·ªëng?')) document.location='/xoa/{{ room.phong_id }}/';">X√≥a ph√≤ng</button>
                      {% else %}
                          <button class="btn btn-delete" onclick="if(confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a th√¥ng tin h·ª£p ƒë·ªìng v√† kh√°ch h√†ng c·ªßa ph√≤ng n√†y? Th√¥ng tin ph√≤ng s·∫Ω ƒë∆∞·ª£c gi·ªØ l·∫°i v√† ƒë·∫∑t v·ªÅ tr·∫°ng th√°i tr·ªëng.')) document.location='/xoa/{{ room.phong_id }}/';">X√≥a h·ª£p ƒë·ªìng</button>
                      {% endif %}
                  </div>
              </div>
              {% empty %}
              <p>Kh√¥ng c√≥ ph√≤ng n√†o trong h·ªá th·ªëng.</p>
              {% endfor %}
          </div>
      </div>
    </div>
  </body>

    
    <script> 
      const toggle = document.querySelector('.menu-toggle');
      const sidebar = document.querySelector('.sidebar');
  
      toggle.addEventListener('click', () => {
        sidebar.classList.toggle('active');
      });

      // Auto-hide messages after 5 seconds
      document.addEventListener('DOMContentLoaded', function() {
        const alerts = document.querySelectorAll('.alert');
        alerts.forEach(function(alert) {
          setTimeout(function() {
            alert.classList.remove('show');
            setTimeout(function() {
              alert.remove();
            }, 150);
          }, 5000);
        });
      });
    </script>


<!-- Th√™m v√†o cu·ªëi file HTML ho·∫∑c trong th·∫ª <script> HI·ªÜU ·ª®NG C·ª¶A B·ªò L·ªåC-->
  <script>
    let lastScroll = 0;
    const nav = document.querySelector('.doi');
    
    window.addEventListener('scroll', () => {
        const currentScroll = window.pageYOffset;
    
        if (currentScroll > lastScroll && currentScroll > 50) {
            // Cu·ªôn xu·ªëng (sau 50px) th√¨ hi·ªán
            nav.classList.remove('hidden');
        } else if (currentScroll < lastScroll && currentScroll > 50) {
            // Cu·ªôn l√™n (sau 50px) th√¨ ·∫©n
            nav.classList.add('hidden');
        } else if (currentScroll <= 50) {
            // Khi ·ªü ƒë·∫ßu trang (d∆∞·ªõi 50px) th√¨ lu√¥n hi·ªán
            nav.classList.remove('hidden');
        }
    
        lastScroll = currentScroll;
    });
    </script>
</html>