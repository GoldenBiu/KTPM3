{% load static %}
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title></title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{% static 'CSS/thongbao.css' %}" />

    <!--css-->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link href="{% static 'app/css/style.css' %}" rel="stylesheet" />
    <link href="{% static 'app/css/owl.caroysel.min.css' %}" rel="stylesheet" />
    <link href="{% static 'app/css/all.min.css' %}" rel="stylesheet" />
    <!-- js -->
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"
      integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
      integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
      integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
      crossorigin="anonymous"
    ></script>

    <script src="{% static 'app/js/s3.js' %}"></script>
    <script src="{% static 'app/js/all.min.js' %}"></script>
    <script src="{% static 'app/js/m√Ωcript.js' %}"></script>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
  </head>

  <body>
    <header class="header">
      <div class="menu-toggle">‚ò∞</div>
      <div class="header-title">Nh√† tr·ªç C·∫ßn Th∆°</div>

      {% comment %}
      <div class="search-bar">
        <input type="text" placeholder="T√¨m ki·∫øm..." />
        <button class="timkiem" type="submit">üîç</button>

        <div class="button-group">
          <button class="btn dathue" type="submit">ƒê√£ thu√™</button>
          <button class="btn phongtrong" type="submit">Ph√≤ng tr·ªëng</button>
          <button class="btn hientatca" type="submit">Hi·ªán t·∫•t c·∫£</button>
        </div>
        {% endcomment %}
      </div>
    </header>

    <div class="sidebar">
      <div class="logo_content">
        <div class="logo">
          <div class="icon">
            <img src="{% static '/imag/moi.jpg' %}" alt="Logo" />
          </div>
          <div class="logo_name">Xin ch√†o, {{ ho_ten_quan_li }}</div>
        </div>
      </div>

      <ul class="nav_list">
        <li>
          <a href="{% url 'menu' %}">
            <span class="icon">üè†</span>
            <span class="link_name">Trang ch·ªß</span>
          </a>
        </li>
        <li>
          <a href="{% url 'quan_ly_khach_hang' %}">
            <span class="icon">üßë‚Äçüíº</span>
            <span class="link_name">Qu·∫£n l√Ω kh√°ch h√†ng</span>
          </a>
        </li>
        <li>
          <a href="{% url 'doanh_thu' %}">
            <span class="icon">üí∞</span>
            <span class="link_name">Doanh thu</span>
          </a>
        </li>
        <li>
          <a href="{% url 'dich_vu' %}">
            <span class="icon">üí°</span>
            <span class="link_name">D·ªãch v·ª•</span>
          </a>
        </li>
        <li>
          <a href="{% url 'hoa_don' %}">
            <span class="icon">üßæ</span>
            <span class="link_name">H√≥a ƒë∆°n</span>
          </a>
        </li>
        <li>
          <a href="{% url 'quan_li_hop_dong' %}">
            <span class="icon">üìÇ</span>
            <span class="link_name">Qu·∫£n l√Ω h·ª£p ƒë·ªìng</span>
          </a>
        </li>
        <li>
          <a href="{% url 'dang_xuat' %}" class="logout-link">
            <span class="icon"><i class="fas fa-sign-out-alt"></i></span>
            <span class="link_name">ƒêƒÉng Xu·∫•t</span>
          </a>
        </li>
      </ul>
    </div>

    <div class="content flex-grow-1 p-4">
      <!-- Thanh c√¥ng c·ª• ph√≠a tr√™n -->
      <div
        class="topbar d-flex justify-content-between align-items-center mb-4"
      >
        <div></div>
      </div>

      <div class="container mt-4">
        <!-- Tab navigation -->
        <ul class="nav nav-tabs" id="messageTabs" role="tablist">
          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="new-messages-tab"
              data-bs-toggle="tab"
              data-bs-target="#new-messages"
              type="button"
              role="tab"
              aria-controls="new-messages"
              aria-selected="true"
            >
              Tin nh·∫Øn m·ªõi
            </button>
          </li>
          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="all-messages-tab"
              data-bs-toggle="tab"
              data-bs-target="#all-messages"
              type="button"
              role="tab"
              aria-controls="all-messages"
              aria-selected="false"
            >
              T·∫•t c·∫£ tin nh·∫Øn
            </button>
          </li>
        </ul>

        <div class="tab-content" id="messageTabsContent">
          <!-- Tab 1: Tin nh·∫Øn m·ªõi -->
          <div
            class="tab-pane fade show active"
            id="new-messages"
            role="tabpanel"
            aria-labelledby="new-messages-tab"
          >
            <div class="room-list-container">
              {% for lien_he in lien_he_list %}
                {% if lien_he.TrangThai == "Ch∆∞a x·ª≠ l√Ω" %}
                  <div class="room-item {% cycle 'alternate-row' '' %}">
                    <h3>STT: {{ forloop.counter }}</h3>
                    <div class="info-row">
                      <p><strong>D√£y:</strong> {{ lien_he.PhongID.DayPhong }}</p>
                      <p><strong>Ph√≤ng:</strong> {{ lien_he.PhongID.SoPhong }}</p>
                      <p>
                        <strong>T√™n:</strong> {{ lien_he.KhachHangID.HoTenKhachHang }}
                      </p>
                      <p><strong>L√Ω do:</strong> {{ lien_he.LyDoLienHe }}</p>
                      <p><strong>N·ªôi Dung:</strong> {{ lien_he.NoiDung }}</p>
                      <p>
                        <strong>Th·ªùi gian:</strong> {{ lien_he.Time|date:"d/m/Y H:i:s" }}
                      </p>
                    </div>
                    <div class="action-buttons">
                      <button
                        class="btn btn-detail"
                        onclick="window.location.href='{% url 'xemtinnhan' lien_he.LienHeID %}'"
                      >
                        Xem tin
                      </button>
                    </div>
                  </div>
                {% endif %}
              {% empty %}
                <p>Ch∆∞a c√≥ tin nh·∫Øn m·ªõi n√†o</p>
              {% endfor %}
            </div>
          </div>
        
          <!-- Tab 2: T·∫•t c·∫£ tin nh·∫Øn -->
          <div
            class="tab-pane fade"
            id="all-messages"
            role="tabpanel"
            aria-labelledby="all-messages-tab"
          >
            <div class="room-list-container">
              {% for lien_he in lien_he_list %}
                <div class="room-item {% cycle 'alternate-row' '' %}">
                  <h3>STT: {{ forloop.counter }}</h3>
                  <div class="info-row">
                    <p><strong>D√£y:</strong> {{ lien_he.PhongID.DayPhong }}</p>
                    <p><strong>Ph√≤ng:</strong> {{ lien_he.PhongID.SoPhong }}</p>
                    <p>
                      <strong>T√™n:</strong> {{ lien_he.KhachHangID.HoTenKhachHang }}
                    </p>
                    <p><strong>L√Ω do:</strong> {{ lien_he.LyDoLienHe }}</p>
                    <p><strong>N·ªôi Dung:</strong> {{ lien_he.NoiDung }}</p>
                    <p>
                      <strong>Th·ªùi gian:</strong> {{ lien_he.Time|date:"d/m/Y H:i:s" }}
                    </p>
                  </div>
                  <div class="action-buttons">
                    <button
                      class="btn btn-detail"
                      onclick="window.location.href='{% url 'xemtinnhan' lien_he.LienHeID %}'"
                    >
                      Xem tin
                    </button>
                  </div>
                </div>
              {% empty %}
                <p>Ch∆∞a c√≥ tin nh·∫Øn li√™n h·ªá n√†o.</p>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>
    const toggle = document.querySelector(".menu-toggle");
    const sidebar = document.querySelector(".sidebar");

    toggle.addEventListener("click", () => {
      sidebar.classList.toggle("active");
    });
  </script>
  <!-- Bootstrap JS -->
  <script
    src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
    integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
    crossorigin="anonymous"
  ></script>
  <script>
    // L·∫•y t·∫•t c·∫£ th·∫ª <p> trong .info-row
    document.querySelectorAll(".info-row p").forEach((p) => {
      // Ch·ªâ x·ª≠ l√Ω th·∫ª <p> c√≥ <strong>N·ªôi Dung:</strong>
      if (
        p.querySelector("strong") &&
        p.querySelector("strong").textContent.trim() === "N·ªôi Dung:"
      ) {
        const text = p.childNodes[1].textContent.trim(); // L·∫•y text sau <strong>
        const words = text.split(" "); // T√°ch th√†nh m·∫£ng c√°c t·ª´

        // Ki·ªÉm tra n·∫øu s·ªë t·ª´ l·ªõn h∆°n 3
        if (words.length > 3) {
          const limitedText = words.slice(0, 3).join(" ") + "..."; // Gi·ªõi h·∫°n 3 t·ª´ v√† th√™m "..."
          p.innerHTML = `<strong>N·ªôi Dung:</strong> ${limitedText}`; // C·∫≠p nh·∫≠t n·ªôi dung
        }
      }
    });
  </script>
</html>
